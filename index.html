
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–ªè³‡è‡ªå‹•è¨ˆç®—ç³»çµ± - å°ˆæ¥­åŒæ­¥ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.25rem;
            padding-right: 2rem;
            color: #1e293b !important;
        }
        input[type="time"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        
        .sync-active { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }

        @media print {
            @page { size: A4; margin: 1cm; }
            body { background-color: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print { display: none !important; }
            input[type="time"]::-webkit-calendar-picker-indicator { display: none; }
            input[type="time"] { border: none; background: transparent; padding: 0; }
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0/client"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useCallback, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';

        // --- Configuration ---
        const DEFAULT_SHEET_ID = "172dQb2Dh7KLFbsYzehQR2xr_7AVtsb3gonSCZZCkIYQ";

        // --- Utils ---
        const timeToMinutes = (timeStr) => {
            if (!timeStr) return 0;
            const parts = timeStr.split(':').map(Number);
            return (parts[0] || 0) * 60 + (parts[1] || 0);
        };

        const calculateDuration = (start, end) => {
            const startMins = timeToMinutes(start);
            const endMins = timeToMinutes(end);
            return endMins > startMins ? (endMins - startMins) / 60 : 0;
        };

        const getDefaultTimes = (dayOfWeek) => {
            // é€±äºŒ (2): 16:00 - 18:00
            if (dayOfWeek === 2) return { start: '16:00', end: '18:00', skipped: false };
            // é€±æ—¥ (0), é€±å…­ (6): é è¨­ä¼‘å‡
            if (dayOfWeek === 0 || dayOfWeek === 6) return { start: '', end: '', skipped: true };
            // å…¶ä»–: 11:30 - 18:30 (å³ä¸‹åˆ 06:30)
            return { start: '11:30', end: '18:30', skipped: false };
        };

        const formatDateKey = (year, month, day) => {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        };
        
        const getDaysInMonth = (year, month) => {
            return new Date(parseInt(year), parseInt(month) + 1, 0).getDate();
        };

        const getFirstDayOfMonth = (year, month) => {
            return new Date(parseInt(year), parseInt(month), 1).getDay();
        };

        // å¼·åŒ–æ™‚é–“æå–ï¼šå¿½ç•¥æ–‡å­—ï¼ŒåªæŠ“å– HH:mm
        const cleanToShortTime = (val) => {
            if (!val) return '';
            const str = val.toString().trim();
            // ç›´æ¥å°‹æ‰¾æ•¸å­—:æ•¸å­—çš„æ¨¡å¼ï¼Œä¸è«–å‰å¾Œæ˜¯å¦æœ‰ã€Œä¸Šåˆ/ä¸‹åˆã€æˆ–ã€ŒAM/PMã€
            const match = str.match(/(\d{1,2}):(\d{1,2})/);
            if (match) {
                let hh = parseInt(match[1]);
                let mm = parseInt(match[2]);
                
                // è™•ç†æŸäº›ç³»çµ±åŒ¯å‡ºæ™‚å¯èƒ½çš„ã€Œä¸‹åˆ 01:00ã€è½‰æˆ 13:00 çš„é‚è¼¯ï¼ˆå¯é¸ï¼Œç›®å‰ç¶­æŒåŸå€¼ï¼‰
                if (str.includes('ä¸‹åˆ') && hh < 12) {
                   // hh += 12; // å¦‚æœæ‚¨çš„è©¦ç®—è¡¨å¯«çš„æ˜¯ã€Œä¸‹åˆ 1:00ã€ä½†æ‚¨è¦çš„æ˜¯ 13:00ï¼Œè«‹å–æ¶ˆæ­¤è¨»è§£
                }

                return `${String(hh).padStart(2, '0')}:${String(mm).padStart(2, '0')}`;
            }
            return '';
        };

        // æ ¸å¿ƒæ›´æ–°ï¼šæ”¯æ´æ›´å¤šæ—¥æœŸè®Šé«”ï¼Œç¢ºä¿ 2026/01/28 100% åŒ¹é…
        const cleanToDateKey = (val) => {
            if (!val) return null;
            const str = val.toString().trim();
            
            // å˜—è©¦åŒ¹é… YYYY/MM/DD æˆ– YYYY-MM-DD (æ”¯æ´å–®ä½æ•¸)
            let match = str.match(/(\d{4})[./\-](\d{1,2})[./\-](\d{1,2})/);
            if (match) {
                return formatDateKey(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
            }
            
            // å˜—è©¦åŒ¹é… MM/DD/YYYY (å¸¸è¦‹æ–¼ US æ ¼å¼)
            match = str.match(/(\d{1,2})[./\-](\d{1,2})[./\-](\d{4})/);
            if (match) {
                return formatDateKey(parseInt(match[3]), parseInt(match[1]) - 1, parseInt(match[2]));
            }

            return null;
        };

        const parseCSV = (text) => {
            if (!text) return { headers: [], data: [] };
            const lines = text.split(/\r?\n/).filter(line => line.trim() !== "");
            if (lines.length === 0) return { headers: [], data: [] };

            const splitLine = (line) => {
                const result = [];
                let current = '';
                let inQuotes = false;
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    if (char === '"') {
                        if (inQuotes && line[i+1] === '"') {
                            current += '"';
                            i++;
                        } else {
                            inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                result.push(current.trim());
                return result;
            };

            const rawHeaders = splitLine(lines[0]);
            const headers = rawHeaders.map(h => h.replace(/^\ufeff/, "").trim());

            const data = lines.slice(1).map(line => {
                const values = splitLine(line);
                return headers.reduce((obj, header, i) => {
                    obj[header] = values[i] || "";
                    return obj;
                }, {});
            });

            return { headers, data };
        };

        // --- Components ---
        const DayCell = ({ day, dateKey, dayOfWeek, entry, onUpdate, isWeekend }) => {
            const dayNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const duration = calculateDuration(entry.start, entry.end);

            return React.createElement('div', {
                className: `min-h-[110px] p-2 border-r border-b transition-colors ${entry.skipped ? 'bg-gray-100/60' : isWeekend ? 'bg-indigo-50/40' : 'bg-white'} hover:bg-slate-50 relative group`
            }, [
                React.createElement('div', { key: 'header', className: "flex justify-between items-start mb-2" }, [
                    React.createElement('div', { key: 'label', className: "flex items-baseline gap-1" }, [
                        React.createElement('span', { key: 'd', className: `text-lg font-bold ${isWeekend ? 'text-red-500' : 'text-indigo-700'}` }, day),
                        React.createElement('span', { key: 'w', className: "text-xs text-gray-500 font-medium" }, `é€±${dayNames[dayOfWeek]}`)
                    ]),
                    React.createElement('div', { key: 'skip', className: "flex items-center gap-1 no-print" }, [
                        React.createElement('input', {
                            type: "checkbox",
                            id: `skip-${dateKey}`,
                            checked: entry.skipped,
                            onChange: (e) => onUpdate(dateKey, { skipped: e.target.checked }),
                            className: "w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer"
                        }),
                        React.createElement('label', { htmlFor: `skip-${dateKey}`, className: "text-[10px] text-gray-400 cursor-pointer" }, "ä¼‘å‡")
                    ]),
                    !entry.skipped && duration > 0 && React.createElement('div', { key: 'print-h', className: "hidden print:block text-xs font-bold text-gray-700" }, `${duration.toFixed(1)}h`)
                ]),
                entry.skipped 
                    ? React.createElement('div', { key: 'vacation', className: "flex items-center justify-center h-12" }, 
                        React.createElement('span', { className: "text-lg font-bold text-gray-400 tracking-widest" }, "ä¼‘å‡")
                      )
                    : React.createElement('div', { key: 'inputs', className: "space-y-1" }, [
                        ['ä¸Šç­', 'start'], ['ä¸‹ç­', 'end']
                    ].map(([label, key]) => (
                        React.createElement('div', { key, className: "flex items-center gap-1" }, [
                            React.createElement('label', { key: 'l', className: "text-[10px] text-gray-400 w-7 no-print" }, label),
                            React.createElement('input', {
                                key: 'i',
                                type: "time",
                                value: entry[key],
                                onChange: (e) => onUpdate(dateKey, { [key]: e.target.value }),
                                className: "w-full text-xs p-1 pr-6 border border-transparent group-hover:border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-indigo-300 print:border-none"
                            })
                        ])
                    )))
            ]);
        };

        const SyncModal = ({ isOpen, onClose, onSync, initialConfig }) => {
            if (!isOpen) return null;
            const [sheetId, setSheetId] = useState(initialConfig?.sheetId || DEFAULT_SHEET_ID);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');
            const [step, setStep] = useState(1);
            const [tempData, setTempData] = useState(null);
            const [mapping, setMapping] = useState(initialConfig?.mapping || { date: '', start: '', end: '' });

            const handleFetch = async () => {
                setIsLoading(true);
                setError('');
                try {
                    const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`;
                    const response = await fetch(csvUrl);
                    if (!response.ok) throw new Error('é€£ç·šå¤±æ•—ã€‚è«‹ç¢ºèªè©¦ç®—è¡¨å·²é–‹å•Ÿå…±ç”¨ã€‚');
                    const text = await response.text();
                    const parsed = parseCSV(text);
                    if (parsed.headers.length === 0) throw new Error('è©¦ç®—è¡¨å…§å®¹ç‚ºç©ºã€‚');
                    
                    setTempData(parsed);
                    setMapping({
                        date: mapping.date || parsed.headers.find(h => h.includes('æ—¥æœŸ')) || '',
                        start: mapping.start || parsed.headers.find(h => h.includes('ä¸Šç­æ™‚é–“')) || '',
                        end: mapping.end || parsed.headers.find(h => h.includes('ä¸‹ç­æ™‚é–“')) || ''
                    });
                    setStep(2);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsLoading(false);
                }
            };

            const executeSync = () => {
                if (!mapping.date || !mapping.start || !mapping.end) {
                    alert('è«‹æ­£ç¢ºå°æ‡‰æ¬„ä½ï¼');
                    return;
                }
                onSync({ sheetId, mapping }, tempData.data);
                onClose();
            };

            return React.createElement('div', { className: "fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm" }, [
                React.createElement('div', { key: 'm', className: "bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden" }, [
                    React.createElement('div', { className: "p-6 border-b flex justify-between items-center" }, [
                        React.createElement('h3', { className: "text-lg font-bold text-slate-800" }, "Google Sheets åŒæ­¥ä¸­å¿ƒ"),
                        React.createElement('button', { onClick: onClose, className: "text-slate-400 hover:text-slate-600" }, "âœ•")
                    ]),
                    React.createElement('div', { className: "p-6" }, 
                        step === 1 ? React.createElement('div', { className: "space-y-4" }, [
                            React.createElement('p', { key: 'p', className: "text-sm text-slate-500" }, "è«‹è²¼ä¸Šæ‚¨çš„è©¦ç®—è¡¨ IDï¼š"),
                            React.createElement('input', {
                                key: 'in',
                                type: "text",
                                value: sheetId,
                                onChange: e => setSheetId(e.target.value),
                                className: "w-full border p-3 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
                            }),
                            error && React.createElement('p', { key: 'e', className: "text-xs text-red-500" }, error)
                        ]) : React.createElement('div', { className: "space-y-3" }, [
                            React.createElement('p', { key: 'p', className: "text-sm text-slate-500 mb-2" }, `è®€å–æˆåŠŸï¼(å…± ${tempData.data.length} ç­†è³‡æ–™)`),
                            ['æ—¥æœŸæ¬„ä½', 'date'], ['ä¸Šç­æ™‚é–“', 'start'], ['ä¸‹ç­æ™‚é–“', 'end']
                        ].map(m => Array.isArray(m) ? React.createElement('div', { key: m[1] }, [
                            React.createElement('label', { className: "text-[10px] font-bold text-slate-400 block mb-1" }, m[0]),
                            React.createElement('select', {
                                value: mapping[m[1]],
                                onChange: e => setMapping(p => ({ ...p, [m[1]]: e.target.value })),
                                className: "w-full border p-2 rounded-lg text-sm bg-slate-50"
                            }, [
                                React.createElement('option', { value: "" }, "-- é¸æ“‡å°æ‡‰æ¬„ä½ --"),
                                ...tempData.headers.map(h => React.createElement('option', { key: h, value: h }, h))
                            ])
                        ]) : m))
                    ),
                    React.createElement('div', { className: "p-6 bg-slate-50 flex gap-2" }, [
                        step === 1 
                        ? React.createElement('button', { onClick: handleFetch, className: "w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all" }, isLoading ? "é€£ç·šä¸­..." : "è®€å–è©¦ç®—è¡¨")
                        : [
                            React.createElement('button', { key: 'b', onClick: () => setStep(1), className: "flex-1 bg-white border py-3 rounded-xl font-bold hover:bg-slate-100" }, "è¿”å›"),
                            React.createElement('button', { key: 's', onClick: executeSync, className: "flex-1 bg-emerald-600 text-white py-3 rounded-xl font-bold hover:bg-emerald-700 shadow-lg shadow-emerald-100" }, "ç«‹å³åŒ¯å…¥")
                        ]
                    ])
                ])
            ]);
        };

        const App = () => {
            const currentYear = new Date().getFullYear();
            const [year, setYear] = useState(currentYear);
            const [month, setMonth] = useState(new Date().getMonth());
            const [hourlyRate, setHourlyRate] = useState(196);
            const [calendarData, setCalendarData] = useState({});
            const [syncConfig, setSyncConfig] = useState({ sheetId: DEFAULT_SHEET_ID, mapping: null });
            const [isSyncing, setIsSyncing] = useState(false);
            const [isSyncModalOpen, setIsSyncModalOpen] = useState(false);

            useEffect(() => {
                const saved = localStorage.getItem('salary-v14-stable');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    setCalendarData(parsed.data || {});
                    setHourlyRate(parsed.rate || 196);
                    if (parsed.sync) setSyncConfig(parsed.sync);
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('salary-v14-stable', JSON.stringify({ data: calendarData, rate: hourlyRate, sync: syncConfig }));
            }, [calendarData, hourlyRate, syncConfig]);

            const handleUpdateEntry = useCallback((dateKey, updates) => {
                setCalendarData(prev => {
                    const existing = prev[dateKey] || { dateKey, ...getDefaultTimes(new Date(dateKey).getDay()), duration: 0 };
                    const updated = { ...existing, ...updates };
                    updated.duration = calculateDuration(updated.start, updated.end);
                    return { ...prev, [dateKey]: updated };
                });
            }, []);

            const processSync = (config, rows) => {
                const newEntries = { ...calendarData };
                let totalUpdated = 0;
                let currentMonthMatches = 0;

                // ç¬¬ä¸€æ­¥ï¼šå°‡è©¦ç®—è¡¨ä¸­çš„æ‰€æœ‰è³‡æ–™å»ºç«‹ä¸€å€‹å°ç…§è¡¨
                rows.forEach(row => {
                    const rawDate = row[config.mapping.date];
                    const dateKey = cleanToDateKey(rawDate);
                    if (!dateKey) return;

                    const start = cleanToShortTime(row[config.mapping.start]);
                    const end = cleanToShortTime(row[config.mapping.end]);
                    
                    if (start && end) {
                        newEntries[dateKey] = {
                            dateKey,
                            start,
                            end,
                            skipped: false,
                            duration: calculateDuration(start, end)
                        };
                        totalUpdated++;
                        
                        // è¨ˆç®—æœ‰å¤šå°‘ç­†æ˜¯å±¬æ–¼ç•¶å‰ç•«é¢ä¸Šé¸å–çš„æœˆä»½
                        if (dateKey.startsWith(`${year}-${String(month + 1).padStart(2, '0')}`)) {
                            currentMonthMatches++;
                        }
                    }
                });

                // ç¬¬äºŒæ­¥ï¼šé‡å°ç•¶å‰æœˆä»½ä¸­ã€Œæ²’æœ‰è³‡æ–™ã€çš„å¤©æ•¸ï¼Œæ ¹æ“šé è¨­è¦å‰‡æ¨™è¨˜ç‚ºä¼‘å‡
                const daysInMonth = getDaysInMonth(year, month);
                for (let d = 1; d <= daysInMonth; d++) {
                    const dateKey = formatDateKey(year, month, d);
                    // å¦‚æœé€™ä¸€å¤©åœ¨å‰›æ‰åŒæ­¥çš„è³‡æ–™ä¸­æ²’æœ‰å‡ºç¾ï¼Œä¸”åŸæœ¬ä¹Ÿæ²’æœ‰æ‰‹å‹•å¡«å¯«è³‡æ–™ï¼Œå‰‡è¨­ç‚ºä¼‘å‡
                    if (!newEntries[dateKey]) {
                        const dayOfWeek = new Date(year, month, d).getDay();
                        newEntries[dateKey] = {
                            ...getDefaultTimes(dayOfWeek), 
                            dateKey, 
                            skipped: true, 
                            duration: 0
                        };
                    }
                }

                setSyncConfig(config);
                setCalendarData(newEntries);

                const report = [
                    `âœ… å…¨åŸŸåŒæ­¥å®Œæˆï¼`,
                    `ğŸ“Š é›²ç«¯ç¸½ç­†æ•¸ï¼š${rows.length} ç­†`,
                    `âœ¨ æˆåŠŸåŒ¯å…¥æœ‰æ•ˆå·¥æ™‚ï¼š${totalUpdated} ç­†`,
                    `ğŸ“… ç•¶å‰è¦–åœ– (${year}/${month+1}) å·²æ›´æ–°ï¼š${currentMonthMatches} ç­†`,
                    `ğŸ’¡ æç¤ºï¼šéç•¶æœˆè³‡æ–™ä¹Ÿå·²åŒæ­¥åˆ°è³‡æ–™åº«ä¸­ï¼Œåˆ‡æ›æœˆä»½å³å¯çœ‹è¦‹ã€‚`
                ];
                alert(report.join('\n'));
            };

            const fastSync = async () => {
                if (!syncConfig || !syncConfig.mapping) {
                    setIsSyncModalOpen(true);
                    return;
                }
                setIsSyncing(true);
                try {
                    const csvUrl = `https://docs.google.com/spreadsheets/d/${syncConfig.sheetId}/export?format=csv`;
                    const response = await fetch(csvUrl);
                    if (!response.ok) throw new Error();
                    const text = await response.text();
                    const parsed = parseCSV(text);
                    processSync(syncConfig, parsed.data);
                } catch (e) {
                    alert('åŒæ­¥å¤±æ•—ã€‚è«‹ç¢ºèªç¶²è·¯ç‹€æ…‹åŠè©¦ç®—è¡¨å…±ç”¨æ¬Šé™ã€‚');
                } finally {
                    setIsSyncing(false);
                }
            };

            const totalHours = useMemo(() => {
                let total = 0;
                const daysInMonth = getDaysInMonth(year, month);
                for (let d = 1; d <= daysInMonth; d++) {
                    const key = formatDateKey(year, month, d);
                    const entry = calendarData[key] || { ...getDefaultTimes(new Date(year, month, d).getDay()) };
                    if (!entry.skipped) total += calculateDuration(entry.start, entry.end);
                }
                return total;
            }, [year, month, calendarData]);

            const daysGrid = useMemo(() => {
                const firstDay = getFirstDayOfMonth(year, month);
                const grid = Array.from({ length: Math.max(0, firstDay) }, () => null);
                const daysInMonth = getDaysInMonth(year, month);
                for (let d = 1; d <= daysInMonth; d++) {
                    const dateKey = formatDateKey(year, month, d);
                    const dayOfWeek = new Date(year, month, d).getDay();
                    grid.push({ 
                        day: d, dateKey, dayOfWeek, 
                        entry: calendarData[dateKey] || { dateKey, ...getDefaultTimes(dayOfWeek), duration: 0 } 
                    });
                }
                return grid;
            }, [year, month, calendarData]);

            return React.createElement('div', { className: "max-w-6xl mx-auto p-4 md:p-8 min-h-screen" }, [
                React.createElement('header', { key: 'h', className: "mb-8 flex flex-col md:flex-row justify-between items-start md:items-end gap-6" }, [
                    React.createElement('div', null, [
                        React.createElement('h1', { className: "text-3xl font-extrabold text-slate-800 flex items-center gap-3" }, [
                            "è–ªè³‡è‡ªå‹•è¨ˆç®—ç³»çµ±",
                            syncConfig.mapping && React.createElement('span', { className: "px-3 py-1 bg-emerald-100 text-emerald-600 text-[10px] rounded-full font-black animate-pulse" }, "é›²ç«¯æ¨¡å¼")
                        ]),
                        React.createElement('p', { className: "text-slate-500 no-print" }, "æ™ºæ…§æ¯”å°ï¼šè‡ªå‹•æå– YYYY/MM/DD èˆ‡ä¸Šä¸‹ç­æ™‚é–“")
                    ]),
                    React.createElement('div', { className: "flex items-center gap-4 no-print" }, [
                        React.createElement('button', { 
                            onClick: fastSync,
                            disabled: isSyncing,
                            title: "é‡æ–°æŠ“å–é›²ç«¯è³‡æ–™",
                            className: `p-3 bg-white text-emerald-600 rounded-2xl border border-emerald-100 shadow-sm hover:shadow-md transition-all ${isSyncing ? 'sync-active' : ''}`
                        }, React.createElement('span', { className: "text-xl" }, "ğŸ”„")),
                        React.createElement('div', { className: "flex gap-2 bg-white p-2.5 rounded-2xl shadow-sm border" }, [
                            { label: 'å¹´ä»½', val: year, set: setYear, opt: Array.from({length:11}, (_,i)=>currentYear-5+i) },
                            { label: 'æœˆä»½', val: month, set: setMonth, opt: Array.from({length:12}, (_,i)=>i) }
                        ].map(s => React.createElement('div', { key: s.label, className: "flex flex-col" }, [
                            React.createElement('span', { className: "text-[9px] font-bold text-slate-400 mb-0.5 ml-1" }, s.label),
                            React.createElement('select', { 
                                value: s.val, 
                                onChange: e => s.set(Number(e.target.value)),
                                className: "bg-transparent px-3 py-1 text-sm font-bold min-w-[90px] text-slate-800 outline-none"
                            }, s.opt.map(o => React.createElement('option', { key: o, value: o }, s.label === 'æœˆä»½' ? `${o+1} æœˆ` : `${o} å¹´`)))
                        ])))
                    ])
                ]),
                React.createElement('main', { key: 'm', className: "bg-white rounded-3xl shadow-sm border overflow-hidden" }, [
                    React.createElement('div', { className: "grid grid-cols-7 bg-slate-50 border-b" }, ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].map((d,i)=>React.createElement('div',{key:d, className:`py-3 text-center text-[10px] font-black uppercase tracking-wider ${i===0||i===6?'text-rose-400':'text-slate-400'}`},`é€±${d}`))),
                    React.createElement('div', { className: "grid grid-cols-7 border-l" }, daysGrid.map((item, i) => 
                        !item ? React.createElement('div', { key: `e-${i}`, className: "bg-slate-50 border-r border-b" }) :
                        React.createElement(DayCell, { key: item.dateKey, ...item, onUpdate: handleUpdateEntry, isWeekend: item.dayOfWeek === 0 || item.dayOfWeek === 6 })
                    ))
                ]),
                React.createElement('div', { key: 's', className: "mt-8 bg-white border border-slate-200 rounded-3xl shadow-xl p-8 print:border-2 print:border-black print:rounded-none" }, [
                    React.createElement('div', { className: "flex flex-col md:flex-row justify-between items-center mb-8 border-b pb-6 print:hidden" }, [
                        React.createElement('h2', { className: "text-2xl font-black text-slate-800" }, "è–ªè³‡çµç®—å ±å‘Š"),
                        React.createElement('div', { className: "flex gap-3" }, [
                            React.createElement('button', { 
                                onClick: () => setIsSyncModalOpen(true), 
                                className: "px-6 py-3 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 transition-all font-bold shadow-sm" 
                            }, "âš™ è¨­å®šé€£å‹•è©¦ç®—è¡¨"),
                            React.createElement('button', { onClick: () => window.print(), className: "px-6 py-3 bg-slate-900 text-white rounded-xl hover:bg-slate-800 transition-all font-bold shadow-lg" }, "åˆ—å°å ±è¡¨")
                        ])
                    ]),
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-8 mb-10 print:grid-cols-3 print:gap-4" }, [
                        { label: 'æ™‚è–ª (TWD)', val: React.createElement('input', { type: 'number', value: hourlyRate, onChange: e => setHourlyRate(Number(e.target.value)), className: "w-full bg-transparent text-3xl font-black text-indigo-600 focus:outline-none print:text-black" }) },
                        { label: 'ç¸½è¨ˆå·¥æ™‚', val: `${totalHours.toFixed(2)}`, suffix: 'Hrs', color: 'text-emerald-500' },
                        { label: 'é è¨ˆç¸½è–ªè³‡', val: `${(totalHours * hourlyRate).toLocaleString()}`, suffix: 'TWD', color: 'text-rose-500' }
                    ].map((s, i) => (
                        React.createElement('div', { key: i, className: "p-6 bg-slate-50 rounded-2xl border border-slate-100 print:bg-white print:border-black" }, [
                            React.createElement('label', { className: "block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2" }, s.label),
                            React.createElement('div', { className: "flex items-baseline gap-2" }, [
                                typeof s.val === 'string' ? React.createElement('span', { className: `text-3xl font-black ${s.color} print:text-black` }, s.val) : s.val,
                                s.suffix && React.createElement('span', { className: "text-xs font-bold text-slate-400" }, s.suffix)
                            ])
                        ])
                    ))),
                    React.createElement('div', { className: "mt-12 pt-10 border-t border-dashed grid grid-cols-3 gap-16 print:mt-4 print:pt-4" }, ['å“¡å·¥ç°½ç« ', 'ä¸»ç®¡è¦†æ ¸', 'è²¡å‹™ç¢ºèª'].map(t => (
                        React.createElement('div', { key: t, className: "flex flex-col gap-6" }, [
                            React.createElement('span', { className: "text-xs font-bold text-slate-400 uppercase tracking-widest print:text-black" }, t),
                            React.createElement('div', { className: "border-b-2 border-slate-200 h-10 print:border-black" })
                        ])
                    )))
                ]),
                React.createElement(SyncModal, { key: 'sync', isOpen: isSyncModalOpen, onClose: () => setIsSyncModalOpen(false), onSync: processSync, initialConfig: syncConfig })
            ]);
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
